---
title: 数据库系统原理：第二章关系数据库（二）
date: 2020-03-13 18:44:09
tags: [数据库系统原理, 笔记]
categories: [数据库系统原理]
index_img: /img/数据库系统/header.png
math: true
---

:star: 数据库系统原理：第二章关系数据库中的关系代数的相关内容。

<!-- more -->

# :star:关系代数
关系代数式一种抽象的查询语言，它用对关系的运算来表达查询。
![](/img/数据库系统/关系代数运算符.png)
其中基本运算为（5种）：

并 $∪$ 、 差 $-$ 、笛卡尔积 $×$ 、 选择 $\sigma$ 、 投影 $\prod$

剩余运算（3种）：

交 $∩$ 、 连接 $\bowtie$ 、 除 $÷$

剩余运算都可以用基本运算表示：
- 交运算 &emsp;&emsp; $R∩S=R-(R-S)$
- 连接运算 &emsp;&emsp; $R\mathop{\bowtie}\limits_{AθB} = \sigma_{AθB}(R×B)$
- 除运算 &emsp;&emsp; $R(X,Y)÷S(Y)=\prod_X(R)-\prod_X(\prod_X(R)×\prod_Y(S)-R)$

## 一、基本运算

**（1）R，t∈R，t[A~i~]**
设关系模式为 R(A~1~,A~2~,...,A~n~)
它的一个关系设为<font color=blue><b>R</b></font>
<font color=blue><b>t∈R</b></font>表示 t 是 R 的一个元组
<font color=blue><b>t[A<sub>i</sub>]</b></font>则表示元组 t 中相应于属性 A~i~ 的一个分量

**（2）A，t[A]，$\overline{A}$**
若<font color=blue><b>A</b></font>={A~i1~，A~i2~,...,A~ik~}，其中A~i1~，A~i2~,...,A~in~是A~1~,A~2~,...,A~n~中的一部分，则A称为属性列或属性组
<font color=blue><b>t[A]</b></font>=(t[A~i1~]，t[A~i2~],...,t[A~ik~])表示元组t在属性列A上诸分量的集合。
<font color=blue><b>$\overline{A}$</b></font>则表示{A~1~,A~2~,...,A~n~}中去掉{A~i1~，A~i2~,...,A~ik~}后剩余的属性组

**（3）$\overgroup{t_rt_s}$**
R为n目关系，S为m目关系。
t~r~∈R，t~s~∈S，<font color=blue><b>$\overgroup{t_rt_s}$</b></font>称为元组的连接
<font color=blue><b>$\overgroup{t_rt_s}$</b></font>是一个n+m列的元组，前n个分量是R中的一个n元组，后m个分量是S中的一个m元组

**（4）象集Z~x~**
给定一个关系R（X，Z），X和Z为属性组。
当t[X]=x时，x在R中的象集为：
$$Z_x=\{t[Z]|t∈R,t[X]=x\}$$
它表示R中属性组X上值为x的诸元组在Z上分量的集合
示例：
|   X   |   Z   |
| :---: | :---: |
| X~1~  | Z~1~  |
| X~1~  | Z~2~  |
| X~1~  | Z~3~  |
| X~2~  | Z~2~  |
| X~2~  | Z~3~  |
| X~3~  | Z~1~  |
| X~3~  | Z~3~  |

则：
- X~1~在R中的象集：&emsp;&emsp;Z~x1~={Z~1~,Z~2~,Z~3~}
- X~2~在R中的象集：&emsp;&emsp;Z~x2~={Z~2~,Z~3~}
- X~3~在R中的象集：&emsp;&emsp;Z~x3~={Z~1~,Z~3~}

## 二、传统集合运算

### 并
R和S
- 具有相同的目n
- 相应的属性取自同一个域
  
R∪S
- 仍为n目关系，由属于R或属于S的元组组成
$$R∪S={t|t∈R∨t∈S}$$
示例：
![](/img/数据库系统/并.png)

### 差
R和S
- 具有相同的目n
- 相应的属性取自同一个域
  
R-S
- 仍为n目关系，由属于R而不属于S的元组组成
$$R-S={t|t∈R∧t\notin S}$$
示例：

以上图为例，则R-S为:

|   A   |   B   |   C   |
| :---: | :---: | :---: |
|  a1   |  b1   |  c1   |

S-R为:

|   A   |   B   |   C   |
| :---: | :---: | :---: |
|  a1   |  b3   |  c2   |
    


### 交
R和S
- 具有相同的目n
- 相应的属性取自同一个域
  
R∪S
- 仍为n目关系，由既属于R又属于S的元组组成
$$R∪S={t|t∈R∧t∈S}$$
示例：
以上图为例，则R∩S为:

|   A   |   B   |   C   |
| :---: | :---: | :---: |
|  a1   |  b2   |  c2   |
|  a2   |  b2   |  c1   |

### 笛卡尔积（积）
R：n目关系，k~1~个元组；S：m目关系，k~2~个元组
R$×$S
- 列：（n+m）列元组的集合
- 行：k~1~$×$k~2~个元组

## 三、关系特有操作

### 选择

- 选择又称为限制
- 选择元素符的含义
  - 在关系R中选择满足给定条件的诸元组
  - $\sigma_F(R)$，F为选择条件，是一个逻辑表达式
    - 基本形式为：XθY
    - θ表示比较运算符，它可以是$>,\ge,<,\le,=,或\neq$

![](/img/数据库系统/选择.png)
例如：
查询信息系（IS系）全体学生
$\sigma_{Sdept='IS'}(Student)$
结果：
|    Sno    | Sname | Ssex  | Sage  | Sdept |
| :-------: | :---: | :---: | :---: | :---: |  |
| 201215125 | 张立  |  男   |  19   |  IS   |
| 201215126 | 李四  |  女   |  20   |  IS   |
可以看出选择出来都是Sdept属性为IS的信息。

### 投影
从R中选择若干属性列组成新的关系
$$\prod_A(R)={t[A]|t∈R}，A:R中的属性列$$
![](/img/数据库系统/投影.png)
例如：
查询学生的姓名和所在系。即求Student关系上学生姓名和所在系两个属性上的投影$\prod_{Sname,Sdept}(Student)$
结果：
| Sname | Sdept |
| :---: | :---: |
| 李勇  |  CS   |
| 刘晨  |  CS   |
| 王铭  |  MA   |
| 张三  |  IS   |

### 连接

连接运算的含义：
从两个关系的笛卡尔积中选取属性间满足一定条件的元组
$$R\mathop{\bowtie}\limits_{AθB}S =\{ \overgroup{t_rt_s}|t_r∈R∧t_s∈S∧t_r[A]θt_s[B]\}$$
- A和B：分别为R和S上度数相等且可比的属性组
- θ比较运算符

>连接运算从R和S关系的广义笛卡尔积R$×$S中选取R关系在A属性组上的值与S关系在B属性组上的值满足比较关系θ的元组。

**两类常用连接运算**
- 等值连接
  - θ为“=”的连接运算称为等值连接
  - 从关系R和S的广义笛卡尔积中选取A、B属性值相等的那些元组。
- 自然连接
  - 自然连接是一种特殊的等值连接
    - 两个关系中进行比较的分量必须是相同的属性组
    - 在结果中会把重复的属性列去掉
  - R和S需要具有相同的属性组

示例：
![](/img/数据库系统/连接示例1.png)
![](/img/数据库系统/连接示例2.png)
![](/img/数据库系统/连接示例3.png)
![](/img/数据库系统/连接示例4.png)

- 悬浮元组
  - 在两个关系R和S做自然连接中，关系R上的某些元组可能在关系S上没有属性值相等的元组，那么这些元组会被遗弃，称为悬浮元组
- 外连接
  - 如果把悬浮元组也保存在结果关系中，而在其他属性上填空值（NULL），称为外连接
  - 如果只保留左边关系R中的悬浮元组，则称为左外连接
  - 如果只保留右边关系S中的悬浮元组，则称为右外连接
![](/img/数据库系统/外连接.png)
![](/img/数据库系统/左右外连接.png)


### 除运算
给定关系R（X，Y）和S（Y，Z），其中X，Y，Z为属性组
R与S除运算得到一个新关系P（X），P是R中满足**元组在X上分量值x的象集Y~x~包含S在Y上投影的集合**的元组在X属性列上的投影。
![](/img/数据库系统/除运算.png)
![](/img/数据库系统/除运算示例.png)

这里可以看到，在关系R中，A可以取四个值（a1，a2，a3，a4）
&emsp;&emsp;&emsp;&emsp;a1的象集为 **{(b1，c2)，(b2，c3)，(b2，c1)}**
&emsp;&emsp;&emsp;&emsp;a2的象集为 **{(b3，c7)，(b2，c3)}**
&emsp;&emsp;&emsp;&emsp;a3的象集为 **{(b4，c6)}**
&emsp;&emsp;&emsp;&emsp;a4的象集为 **{(b6，c6)}**
而S在（B，C）上的投影为
&emsp;&emsp;&emsp;&emsp; **{(b1，c2)，(b2，c1)，(b2，c3)}**
在这个例子中，只有a1的象集包含了S在（B，C）属性组上的投影
所以R÷S={a1}
<p class="note note-primary">只要出现了<b>全部、所有</b>字样的题目都需要用到除运算</p>